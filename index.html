<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <style>
        .col-xs-6,.col-sm-2,.col-xs-12,.col-sm-4{
            padding-left: 30px;
        }
        .container{
            padding: 10px;
            background: #eee;
        }
        .row{
            padding:10px;
            margin: 0 30px;
        }
        .row p{
            padding-left: 20px;
        }
        h4{
            padding: 10px 10px;
        }
        label{
            font-weight: lighter;
        }
        #pageNum{
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container" id="app">
    <h2 style="text-align: center">2017年湖北省国税局纳税人满意度专项调查问卷</h2>
    <form @submit.prevent="submit">
        <div>
            <h4>{{obj.groupTitle}}</h4>
            <div v-for="(pro,k) in obj.problemList"  v-if="isShow[k]===0?true:false">
                <p>{{pro.problemInfoTitle}}</p>
                <div class="container">
                    <div v-for="an in pro.answerOption" v-bind:class="[cls.c1,cls.c2]">
                        <label>
                            <input v-on:change="getMsg(k,pro.problemInfoID,an.id)"  v-bind:type="pro.proType===0?'radio':'checkbox'" v-bind:name="pro.problemInfoID" v-bind:value="an.id">
                            {{ans.content}}
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <input type="submit" value="提交">
    </form>
    {{ans.model}}
    {{msg.model}}
    <div id="pageNum"><button  id="preItem" v-on:click="pre()">上一题</button>第 <span>{{pageN+1}}</span>/{{pageEnd+1}}<button id="nextItem" v-on:click="next()">下一题</button></div>
</div>

<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="js/vue-resource.js"></script>
<script>

    var app1=new Vue({
        el:"#app",
        data:{
            pageN:0,//记录题组及页面
            pageEnd:9,//最后一题题组
            obj:{},//测试题内容
            cls:{},//控制选项的class
            isShow:[],//显示和隐藏
            ans:{//记录当前题组问题及答案
                groupId:"",//题组id
                model:[]//本题组小题内容id和answer
            },
            msg:{//提交的数据
                model: [//盛放题组的容器
                ],
                sourceType:"",
                sourceDetail: "",
                taxAuthCode: ""
            }
        },
        mounted:function(){
            this.add(0);//加载第一页面
            this.msg.model=new Array(10)//初始化题组数
        },
        methods:{
            before:function(){
                this.msg.model[this.pageN]=this.ans.model;//把本页问题答案放在题组容器
                this.ans.model=[];//本页题组为空数组
                this.isShow=[];//状态盛放显示数组
            },
            pre:function(){
                this.before();
                this.pageN--;//页面减一
                this.pageN=this.pageN<0?0:this.pageN;
                this.add(this.pageN)//调用添加页面
            },
            next:function(){
                this.before();
                this.pageN++;
                this.pageN=this.pageN>this.pageEnd?this.pageEnd:this.pageN;
                this.add(this.pageN)
            },
            add:function(groupId){
                var url="http://hbgs12366.dfinfo.cn/api/Values/GetAnswerByID";
                this.$http.post(url,{groupID:groupId}).then(function(data){
                    this.obj=data.body;//把请求数据赋值给本地
                    console.log(this.obj);
                    //遍历请求题组
                    for(var i=0;i<this.obj.problemList.length;i++){
                        this.ans.model[i]="";//根据题的数量生成容器
                        this.isShow[i]=this.obj.problemList[i].isShow;//根据题的状态生成容器
                    };
                    if(this.obj.problemList[0].proType===0){//单选类型
                        this.cls={c1:"col-xs-6",c2:"col-sm-3"}
                    };
                },function(response){
                    console.log(response+"请求错误");
                })
            },
            getMsg:function(k,n,v){
                //把题目答案赋给状态的
                Vue.set(this.ans.model,k,{problemID:n,answerID:v});
                /*if(this.ans.model[0].answerID<3){
                    Vue.set(this.isShow,1,0);
                }else{
                    Vue.set(this.isShow,1,1);
                    Vue.set(this.ans.model,1,"");
                }*/
            },
            watch:function(){

            }

        }
    });

</script>
</body>
</html>